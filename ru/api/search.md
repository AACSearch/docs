# API поиска

API поиска является основой AACSearch, позволяя выполнять поисковые запросы по вашим индексам. Эта документация предоставляет подробную информацию о том, как использовать API поиска для получения релевантных результатов для ваших пользователей.

## Обзор

Конечная точка API поиска позволяет искать объекты в определенном индексе. Вы можете настроить поиск с помощью различных параметров для фильтрации, сортировки и уточнения результатов.

- **Конечная точка**: `GET /search`
- **Аутентификация**: Требуется API-ключ, передаваемый в заголовке как `X-API-Key`.

## Базовый поисковый запрос

Для выполнения базового поиска необходимо указать поисковый запрос и индекс, в котором будет выполняться поиск. Вот пример:

```bash
curl -X GET "https://api.aacsearch.com/search" \
  -H "X-API-Key: your-api-key" \
  -G \
  -d "q=смартфон" \
  -d "index=продукты"
```

### Ответ

Успешный поисковый запрос возвращает JSON-ответ с результатами поиска:

```json
{
  "hits": [
    {
      "id": "123",
      "title": "Смартфон Модель X",
      "description": "Последняя модель с продвинутыми функциями.",
      "category": "электроника",
      "price": 699.99
    },
    {
      "id": "124",
      "title": "Смартфон Модель Y",
      "description": "Доступный смартфон с отличной производительностью.",
      "category": "электроника",
      "price": 399.99
    }
  ],
  "nbHits": 2,
  "page": 1,
  "nbPages": 1,
  "hitsPerPage": 20,
  "processingTimeMS": 3,
  "query": "смартфон",
  "params": "q=смартфон&index=продукты"
}
```

## Параметры поиска

API поиска поддерживает множество параметров для уточнения результатов поиска. Ниже приведены наиболее часто используемые параметры:

- **`q`**: Строка поискового запроса. Это текст, который ищут пользователи. Пример: `q=смартфон`.
- **`index`**: Название индекса, в котором выполняется поиск. Пример: `index=продукты`.
- **`filters`**: Фильтры, применяемые к результатам поиска. Фильтры используются для сужения результатов на основе определенных критериев. Пример: `filters=category:электроника AND price:100 TO 1000`.
- **`facets`**: Фасеты для агрегации, позволяющие получить количество результатов для конкретных категорий или значений. Пример: `facets=бренд,цена`.
- **`attributesToRetrieve`**: Указывает, какие поля объектов возвращать в результатах. Пример: `attributesToRetrieve=title,description,price`.
- **`attributesToHighlight`**: Поля для подсветки в результатах поиска (например, совпадающие с поисковым запросом термины). Пример: `attributesToHighlight=title,description`.
- **`page`**: Номер страницы для пагинации. Пример: `page=2`.
- **`hitsPerPage`**: Количество результатов на странице. По умолчанию 20. Пример: `hitsPerPage=10`.
- **`sortBy`**: Сортировка результатов по определенному полю. Пример: `sortBy=price:asc` для сортировки по возрастанию цены.

### Пример с параметрами

Вот пример поискового запроса с несколькими параметрами:

```bash
curl -X GET "https://api.aacsearch.com/search" \
  -H "X-API-Key: your-api-key" \
  -G \
  -d "q=смартфон" \
  -d "index=продукты" \
  -d "filters=category:электроника AND price:100 TO 1000" \
  -d "facets=бренд,цена" \
  -d "attributesToRetrieve=title,description,price" \
  -d "attributesToHighlight=title" \
  -d "page=1" \
  -d "hitsPerPage=5" \
  -d "sortBy=price:desc"
```

### Ответ с фасетами

Когда запрашиваются фасеты, ответ включает количество по фасетам:

```json
{
  "hits": [
    {
      "id": "123",
      "title": "<em>Смартфон</em> Модель X",
      "description": "Последняя модель с продвинутыми функциями.",
      "price": 699.99
    }
    // ... больше результатов
  ],
  "nbHits": 5,
  "page": 1,
  "nbPages": 1,
  "hitsPerPage": 5,
  "processingTimeMS": 4,
  "query": "смартфон",
  "params": "q=смартфон&index=продукты&filters=category:электроника AND price:100 TO 1000&facets=бренд,цена&attributesToRetrieve=title,description,price&attributesToHighlight=title&page=1&hitsPerPage=5&sortBy=price:desc",
  "facets": {
    "бренд": {
      "БрендA": 2,
      "БрендB": 3
    },
    "цена": {
      "100-500": 2,
      "501-1000": 3
    }
  }
}
```

## Продвинутые функции поиска

### Толерантность к опечаткам

AACSearch автоматически обрабатывает опечатки в поисковых запросах. Вы можете настроить параметры толерантности к опечаткам через [API настроек](./settings.md).

### Синонимы

AACSearch поддерживает синонимы для улучшения релевантности поиска. Например, поиск по слову "телефон" может возвращать результаты для "смартфон", если синонимы настроены. Смотрите [Синонимы](../guides/search/synonyms.md) для инструкций по настройке.

### Настройка релевантности

Вы можете настроить, как ранжируются результаты, используя настройку релевантности. Узнайте больше в [Настройка релевантности](../guides/search/relevance.md).

## Ограничения скорости

Учитывайте ограничения скорости при использовании API поиска. Если вы превысите лимит, вы получите ошибку `429 Too Many Requests`. Подробности об ограничении скорости смотрите в [Ограничение запросов](../guides/security/rate-limiting.md).

## Устранение неисправностей

Если вы столкнулись с проблемами в результатах поиска:

- Убедитесь, что ваш индекс содержит ожидаемые данные.
- Проверьте ваши фильтры и параметры на наличие опечаток или неправильного синтаксиса.
- Ознакомьтесь с разделом [Ошибки API](../troubleshooting/api-errors.md) для конкретных кодов ошибок.
- Включите режим отладки для подробных логов, как описано в [Режим отладки](../troubleshooting/debug.md).

## Дополнительные ресурсы

- [Дашборд AACSearch](https://dashboard.aacsearch.com) - Управление вашими индексами и просмотр аналитики поиска.
- [Площадка API](https://api.aacsearch.com/playground) - Интерактивное тестирование поисковых запросов.
- [Настройка поиска](../guides/dashboard/search-config.md) - Настройка поведения поиска через дашборд.
