# Веб-хуки

Веб-хуки в AACSearch позволяют настроить автоматическую отправку данных о событиях в вашей поисковой системе на внешние URL-адреса. Это мощный инструмент для интеграции AACSearch с другими системами, автоматизации процессов и мониторинга. Этот раздел объясняет, как настроить и использовать веб-хуки.

## Что такое веб-хуки

Веб-хуки — это HTTP-запросы, которые AACSearch отправляет на указанный вами URL при наступлении определенных событий. Они позволяют в реальном времени получать данные о действиях в вашей поисковой системе, таких как обновление индекса, поисковые запросы или ошибки.

Примеры использования веб-хуков:

- **Интеграция с аналитикой**: Отправка данных о поисковых запросах в вашу систему аналитики.
- **Автоматизация**: Обновление внешних систем при изменении данных в индексе.
- **Мониторинг**: Уведомление о сбоях или проблемах через Slack, email или другие каналы.

## Настройка веб-хуков

AACSearch позволяет настраивать веб-хуки через API или панель управления для отслеживания различных событий:

1. **Создание веб-хука**  
   Укажите URL, на который будут отправляться данные, и события, которые вы хотите отслеживать.

   ```json
   {
     "webhooks": [
       {
         "url": "https://your-endpoint.com/webhook",
         "events": ["search", "index.update", "error"],
         "enabled": true
       }
     ]
   }
   ```

2. **Формат данных веб-хука**  
   Данные отправляются в формате JSON с информацией о событии. Пример данных для события поиска:

   ```json
   {
     "event": "search",
     "index": "products",
     "query": "смартфон",
     "userId": "user123",
     "timestamp": "2023-07-01T10:00:00Z",
     "results": {
       "nbHits": 10,
       "hits": [
         {
           "objectID": "prod_123",
           "name": "Смартфон XYZ"
         }
       ]
     }
   }
   ```

3. **Безопасность веб-хуков**  
   Настройте подпись запросов для проверки подлинности данных, отправляемых на ваш URL.
   ```json
   {
     "webhooks": [
       {
         "url": "https://your-endpoint.com/webhook",
         "events": ["search"],
         "secret": "your-secret-key-for-signature"
       }
     ]
   }
   ```

## Обработка веб-хуков

Ваш сервер должен быть готов принимать POST-запросы с данными веб-хуков. Убедитесь, что:

- Сервер возвращает HTTP-код 200 для подтверждения успешного получения данных.
- Запросы обрабатываются быстро, чтобы избежать таймаутов.
- Ошибки логируются для последующего анализа.

Пример обработки веб-хука на Node.js:

```javascript
const express = require("express");
const app = express();
app.use(express.json());

app.post("/webhook", (req, res) => {
  const eventData = req.body;
  console.log("Получено событие:", eventData.event);

  // Обработка данных события
  if (eventData.event === "search") {
    console.log("Поисковый запрос:", eventData.query);
    // Отправка данных в систему аналитики или логирование
  }

  res.status(200).send("OK");
});

app.listen(3000, () => {
  console.log("Сервер веб-хуков запущен на порту 3000");
});
```

## Типы событий для веб-хуков

AACSearch поддерживает множество событий, которые можно отслеживать через веб-хуки:

- **search**: Выполнен поисковый запрос.
- **index.update**: Обновление данных в индексе (добавление, изменение, удаление объектов).
- **index.create**: Создание нового индекса.
- **index.delete**: Удаление индекса.
- **error**: Возникновение ошибки (например, сбой индексации).
- **analytics**: События аналитики, такие как клики или конверсии.

## Рекомендации

- **Надежность**: Убедитесь, что ваш сервер веб-хуков доступен и может обрабатывать нагрузку. Используйте очереди для обработки больших объемов данных.
- **Безопасность**: Всегда проверяйте подпись веб-хуков, чтобы убедиться, что данные пришли от AACSearch.
- **Тестирование**: Используйте тестовые веб-хуки в панели управления для проверки формата данных и обработки на вашем сервере.

Для более детальной информации о веб-хуках обратитесь к [руководству по API](../api/quickstart.md) и [интеграциям](../integrations/segment.md).
