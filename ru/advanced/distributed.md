# Распределенный поиск

Распределенный поиск в AACSearch позволяет обрабатывать большие объемы данных и запросов, распределяя нагрузку между несколькими узлами. Этот раздел объясняет, как работает распределенная архитектура и как она обеспечивает масштабируемость и отказоустойчивость.

## Принципы распределенного поиска

AACSearch использует распределенную архитектуру для обеспечения высокой производительности:

- **Шардирование**: Данные индекса разбиваются на части (шарды), которые распределяются по узлам. Это позволяет параллельно обрабатывать запросы.
- **Репликация**: Каждый шард имеет несколько копий (реплик), хранящихся на разных узлах, для повышения отказоустойчивости и скорости доступа.
- **Балансировка нагрузки**: Запросы распределяются между узлами, чтобы избежать перегрузки одного сервера.
- **Координация**: Центральный координатор управляет распределением запросов и сбором результатов с разных узлов.

## Как работает распределенный поиск

1. **Разделение данных**  
   При создании или обновлении индекса данные автоматически разбиваются на шарды на основе их объема и настроек.

   - Шарды распределяются по узлам для равномерной нагрузки.

2. **Обработка запроса**  
   Когда поступает поисковый запрос, координатор определяет, какие шарды содержат релевантные данные, и направляет запрос к соответствующим узлам.

   - Каждый узел выполняет поиск в своих шардах параллельно.
   - Если основной узел недоступен, запрос перенаправляется к реплике.

3. **Сбор результатов**  
   Результаты с разных узлов собираются координатором, ранжируются и возвращаются пользователю.
   - Координатор также обрабатывает агрегацию данных, например, для фасетного поиска.

## Преимущества распределенного поиска

- **Масштабируемость**: Добавление новых узлов увеличивает производительность системы для обработки большего числа запросов.
- **Отказоустойчивость**: Репликация данных гарантирует, что поиск остается доступным даже при сбое одного или нескольких узлов.
- **Скорость**: Параллельная обработка запросов на нескольких узлах снижает время ответа.

## Настройка распределенного поиска

AACSearch автоматически управляет распределением данных, но вы можете настроить параметры для оптимизации:

1. **Количество шардов и реплик**  
   Укажите, на сколько частей разбивать индекс и сколько копий создавать.

   ```json
   {
     "settings": {
       "numberOfShards": 4,
       "numberOfReplicas": 2
     }
   }
   ```

2. **Расположение узлов**  
   Настройте географическое распределение узлов для снижения задержек в разных регионах.
   ```json
   {
     "settings": {
       "regions": ["europe", "us-east", "asia"]
     }
   }
   ```

## Мониторинг и устранение неисправностей

- Используйте встроенные инструменты мониторинга для отслеживания состояния узлов и производительности шардов.
- Настройте уведомления о сбоях узлов или проблемах с репликацией через панель управления.

Для более детальной информации о распределенном поиске обратитесь к [руководству по архитектуре системы](./architecture.md) и [высокой доступности](./ha.md).
